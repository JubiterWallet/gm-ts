import test from 'ava';

import { computeZDigest, Z } from './util';

test('util computeZDigest ', (t) => {
  const data =
    'from=0x6469643a6870633a526564436176653a63613764633364383330316431343764323731373263396334643764643163623431643735363063&to=0x6469643a6870633a526564436176653a63613764633364383330316431343764323731373263396334643764643163623431643735363063&value=0x0&payload=0x7b2264696441646472657373223a226469643a6870633a526564436176653a63613764633364383330316431343764323731373263396334643764643163623431643735363063222c227374617465223a302c227075626c69634b6579223a7b2274797065223a22736d32222c226b6579223a2242412b54647770364376516f77386d536a77636375465a5670747864326c63764c356c4f363832505348445353447573736e707a3841784e746a433273545949484c6c624a5979683651686955515357375559446b326f3d227d7d&timestamp=0x16f2496da73d66b5&nonce=0xd7af9ffc0cd8b&opcode=c8&extra=&vmtype=TRANSFER&version=3.2&extraid=&cname=';
  const pubKey =
    '040f93770a7a0af428c3c9928f071cb85655a6dc5dda572f2f994eebcd8f4870d2483bacb27a73f00c4db630b6b136081cb95b258ca1e90862510496ed4603936a';
  const r = computeZDigest(data, pubKey, {
    dataEncoding: 'utf8',
    keyEncoding: 'hex',
    hashEncoding: 'hex',
  });
  console.log('result --------------> ', r);
  t.log('result--->', r);
});

test('util Z', (t) => {
  const pubKey =
    '040f93770a7a0af428c3c9928f071cb85655a6dc5dda572f2f994eebcd8f4870d2483bacb27a73f00c4db630b6b136081cb95b258ca1e90862510496ed4603936a';
  const z = Z(pubKey, { keyEncoding: 'hex', hashEncoding: 'hex' });
  t.log('z: ', z);
  t.assert(
    z === '67871e6796a96fc7550c426dec248debe2aee0b1841a6de13ff3df03ce1168e8'
  );
});
