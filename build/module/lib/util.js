import { SM2 } from './sm2';
import { SM3 } from './sm3';
export function computeZDigest(data, pubKey, { dataEncoding, keyEncoding, hashEncoding, }) {
    // e = sm3(Z||msg)
    const sm3 = new SM3();
    sm3.update(Z(pubKey, { keyEncoding }));
    sm3.update(data, dataEncoding);
    return sm3.final(hashEncoding);
}
export function Z(key, { keyEncoding, hashEncoding }) {
    // Z = h(ENTL || ID || a || b || xG || yG || xA || yA)
    const sm2 = new SM2();
    //const curve = sm2.curve as curve.short;
    const P = sm2.keyFromPublic(key, keyEncoding).getPublic();
    const id = '1234567812345678';
    const sm3 = new SM3();
    const idLen = id.length * 8;
    const entl = Buffer.alloc(2);
    entl[0] = idLen >>> 8;
    entl[1] = idLen & 0xff;
    sm3.update(entl);
    sm3.update(id);
    // use origin value. values in curve maybe changed for compute easy
    const a = 'FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC';
    const b = '28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93'; // <--- YES this gay!
    const gx = '32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7';
    const gy = 'BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0';
    const px = Buffer.from(P.getX().toArray());
    const py = Buffer.from(P.getY().toArray());
    sm3.update(a, 'hex');
    sm3.update(b, 'hex');
    sm3.update(gx, 'hex');
    sm3.update(gy, 'hex');
    sm3.update(px);
    sm3.update(py);
    return sm3.final(hashEncoding);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQzVCLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFFNUIsTUFBTSxVQUFVLGNBQWMsQ0FDNUIsSUFBcUIsRUFDckIsTUFBb0MsRUFDcEMsRUFDRSxZQUFZLEVBQ1osV0FBVyxFQUNYLFlBQVksR0FLYjtJQUVELGtCQUFrQjtJQUNsQixNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ3RCLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUN2QyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUMvQixPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDakMsQ0FBQztBQUVELE1BQU0sVUFBVSxDQUFDLENBQ2YsR0FBaUMsRUFDakMsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFrRDtJQUU3RSxzREFBc0Q7SUFDdEQsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUN0Qix5Q0FBeUM7SUFDekMsTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDMUQsTUFBTSxFQUFFLEdBQUcsa0JBQWtCLENBQUM7SUFDOUIsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUN0QixNQUFNLEtBQUssR0FBRyxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUM1QixNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzdCLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLEtBQUssQ0FBQyxDQUFDO0lBQ3RCLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDO0lBQ3ZCLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDakIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNmLG1FQUFtRTtJQUNuRSxNQUFNLENBQUMsR0FBRyxrRUFBa0UsQ0FBQztJQUM3RSxNQUFNLENBQUMsR0FBRyxrRUFBa0UsQ0FBQyxDQUFDLHFCQUFxQjtJQUNuRyxNQUFNLEVBQUUsR0FBRyxrRUFBa0UsQ0FBQztJQUM5RSxNQUFNLEVBQUUsR0FBRyxrRUFBa0UsQ0FBQztJQUM5RSxNQUFNLEVBQUUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBQzNDLE1BQU0sRUFBRSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDM0MsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdEIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdEIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNmLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDZixPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDakMsQ0FBQyJ9